(()=>{"use strict";const e="https://http-hefg.onrender.com",t=document.querySelector(".container"),n=document.querySelector(".tickets-container"),a=document.querySelector(".add-ticket-button"),d=new class{getTicket(e){return`\n  <div data-id="${e.id}" class="ticket-wrapper">\n    <div class="ticket-body">\n      <div data-status="${e.status}" class="ticket-status">\n      <span class="ticket-status-checkbox hidden">&#10004;</span>\n      </div>\n      <div class="ticket-name"><p>${e.name}</p></div>\n      <div class="ticket-timestamp">\n        <span>${e.created}</span>\n      </div>\n      <div class="ticket-edit-button">\n      <span>&#9998;</span>\n      </div>\n      <div class="ticket-remove-button">\n        <span>&#10006;</span>\n      </div>\n    </div>\n    <div class="ticket-description hidden"><p></p></div>\n  </div>`}},s=new class{changeTicketStatus(e,t,n,a,d){if(e.querySelector(".modal"))return;let{status:s}=n.dataset;const r=a.classList.contains("hidden");r&&(s=!0),r||(s=!1);const i=new FormData;i.append("id",t.dataset.id),i.append("status",s);const c=`${d}/status`,o=new XMLHttpRequest;o.open("POST",c),document.body.style.cursor="wait",o.addEventListener("load",(()=>{o.status>=200&&o.status<300&&(o.response.success||a.classList.toggle("hidden"),document.body.style.cursor="")})),o.send(i)}},r=new class{showDescription(e,t,n,a){if(e.querySelector(".modal"))return;const d=n.closest(".ticket-wrapper").querySelector(".ticket-description");if(!d.classList.contains("hidden"))return void d.classList.add("hidden");const s=`${a}/${t.dataset.id}`,r=new XMLHttpRequest;r.open("GET",s),document.body.style.cursor="wait",r.addEventListener("load",(()=>{if(r.status>=200&&r.status<300)try{const{response:e}=r;document.body.style.cursor="",d.textContent=e,d.classList.toggle("hidden")}catch(e){console.error("error",e)}})),r.send()}},i=new class{editTicketCancelButtonHandler(e){if(!e)return;const t=e.querySelector("[data-widget=editTicket]"),n=t.querySelector("[data-id=editTicket-form]");t.querySelector("[data-id=cancel]").addEventListener("click",(()=>{n.reset(),t.remove()}))}editTicketSubmitHandler(e,t,n){if(!e)return;const a=e.querySelector("[data-widget=editTicket]"),d=a.querySelector("[data-id=editTicket-form]"),s=a.querySelector("[data-id=name]"),r=t.closest(".ticket-wrapper").dataset.id,i=t.closest(".ticket-wrapper").querySelector(".ticket-name").textContent,c=t.closest(".ticket-wrapper").querySelector(".ticket-status").dataset.status;s.value=i,d.addEventListener("submit",(e=>{e.preventDefault();const t=d.name.value.trim(),s=d.description.value.trim();if(""===t)return;const i=new FormData;i.append("id",r),i.append("name",t),i.append("description",s),i.append("status",c),i.append("created",(new Date).toLocaleString());const o=`${n}/`,l=new XMLHttpRequest;l.open("POST",o),document.body.style.cursor="wait",a.style.cursor="wait",l.addEventListener("load",(()=>{if(l.status>=200&&l.status<300)try{document.body.style.cursor="",a.style.cursor="",setTimeout((()=>{document.location.reload()}),300)}catch(e){console.error("error",e)}})),d.reset(),a.remove(),l.send(i)}))}createRequestTicketDescription(e,t,n){if(!e)return;const a=e.querySelector("[data-widget=editTicket]").querySelector("[data-id=description]"),d=`${n}/${t.dataset.id}`,s=new XMLHttpRequest;s.open("GET",d),s.addEventListener("load",(()=>{if(s.status>=200&&s.status<300)try{const e=s.response;a.value=e}catch(e){console.error(e)}})),s.send()}getEditTicket(e,t,n,a){e.querySelector(".modal")||(e.insertAdjacentHTML("beforeEnd",'\n      <div data-widget="editTicket" class="modal widget-edit">\n      <h2>Редактировать тикет</h2>  \n      <form data-id="editTicket-form" class="widget-form">\n        <label>\n          Краткое описание\n            <textarea rows=1 data-id="name" name="name" required class="widget-input"></textarea>\n        </label>\n        <label>\n          Подробное описание\n            <textarea rows=3 data-id="description" name="description" class="widget-input"></textarea>\n        </label>\n        <div class="widget-form-controls">\n          <button data-id="cancel" class="widget-button">Отмена</button>  \n          <button type="submit" data-id="ok" class="widget-button">Ок</button> \n        </div>     \n      </form>\n      </div>\n      '),this.createRequestTicketDescription(e,t,a),this.editTicketCancelButtonHandler(e),this.editTicketSubmitHandler(e,n,a))}},c=new class{removeTicketCancelButtonHandler(e){if(!e)return;const t=e.querySelector("[data-widget=removeTicket]");t.querySelector("[data-id=cancel]").addEventListener("click",(()=>{t.remove()}))}removeTicketOkButtonHandler(e,t,n){if(!e)return;const a=e.querySelector("[data-widget=removeTicket]");a.querySelector("[data-id=ok]").addEventListener("click",(()=>{const e=new FormData;e.append("id",t.dataset.id);const d=`${n}/id`,s=new XMLHttpRequest;s.open("POST",d),s.responseType="json",document.body.style.cursor="wait",s.addEventListener("load",(()=>{if(s.status>=200&&s.status<300)try{setTimeout((()=>{document.location.reload()}),300),document.body.style.cursor=""}catch(e){console.error("error",e)}})),a.remove(),s.send(e)}))}remove(e,t,n){e.querySelector(".modal")||(e.insertAdjacentHTML("beforeEnd",'\n      <div data-widget="removeTicket" class="modal widget-remove">\n        <h2>Удалить тикет?</h2>  \n        <div class="widget-form">\n          <p class="widget-remove-text">Вы уверены, что хотите удалить тикет? Это действие необратимо.</p>\n          <div class="widget-form-controls">\n            <button data-id="cancel" class="widget-button">Отмена</button>  \n            <button data-id="ok" class="widget-button">Ок</button> \n          </div> \n        </div>\n      </div>\n      '),this.removeTicketCancelButtonHandler(e),this.removeTicketOkButtonHandler(e,t,n))}},o=new class{addTicketCancelButtonHandler(e){if(!e)return;const t=e.querySelector("[data-widget=addTicket]"),n=t.querySelector("[data-id=addTicket-form]");t.querySelector("[data-id=cancel]").addEventListener("click",(()=>{n.reset(),t.remove()}))}addTicketSubmitHandler(e,t){if(!e)return;const n=e.querySelector("[data-widget=addTicket]"),a=n.querySelector("[data-id=addTicket-form]");a.addEventListener("submit",(e=>{e.preventDefault();const d=a.name.value.trim(),s=a.description.value.trim();if(""===d)return;const r=new FormData;r.append("name",d),r.append("description",s),r.append("status",!1),r.append("created",(new Date).toLocaleString());const i=`${t}/`,c=new XMLHttpRequest;c.open("POST",i),document.body.style.cursor="wait",n.style.cursor="wait",c.addEventListener("load",(()=>{if(c.status>=200&&c.status<300)try{setTimeout((()=>{document.body.style.cursor="",n.style.cursor="",document.location.reload()}),300)}catch(e){console.error("error",e)}})),c.send(r),a.reset(),n.remove()}))}getWidget(e,t){e.querySelector(".modal")||(e.insertAdjacentHTML("beforeEnd",'\n      <div data-widget="addTicket" class="modal widget-add">\n      <h2>Добавить тикет</h2>  \n      <form data-id="addTicket-form" class="widget-form">\n        <label>\n          Краткое описание\n            <textarea rows=2 data-id="name" name="name" required class="widget-input"></textarea>\n        </label>\n        <label>\n          Подробное описание\n            <textarea rows=5 data-id="description" name="description" class="widget-input"></textarea>\n        </label>\n        <div class="widget-form-controls">\n          <button data-id="cancel" class="widget-button">Отмена</button>  \n          <button type="submit" data-id="ok" class="widget-button">Ок</button> \n        </div>     \n      </form>\n      </div>\n      '),this.addTicketCancelButtonHandler(e),this.addTicketSubmitHandler(e,t))}};document.addEventListener("DOMContentLoaded",(()=>{const l=new XMLHttpRequest;l.open("GET",`${e}/allTickets`),l.responseType="json",l.addEventListener("load",(()=>{if(l.status>=200&&l.status<300)try{const a=l.response;if(a&&!a.length)return;a.forEach((a=>{const o=d.getTicket(a);n.insertAdjacentHTML("beforeEnd",o);const l=n.lastElementChild,u=l.querySelector(".ticket-status"),m=u.querySelector(".ticket-status-checkbox");"true"===u.dataset.status&&m.classList.remove("hidden");const p=l.querySelector(".ticket-name"),v=l.querySelector(".ticket-edit-button"),k=l.querySelector(".ticket-remove-button");u.addEventListener("click",(()=>{s.changeTicketStatus(t,l,u,m,e)})),p.addEventListener("click",(()=>{r.showDescription(t,l,p,e)})),v.addEventListener("click",(()=>{i.getEditTicket(t,l,v,e)})),k.addEventListener("click",(()=>{c.remove(t,l,e)}))}))}catch(e){console.error("error",e)}})),l.send(),a.addEventListener("click",(()=>{o.getWidget(t,e)}))}))})();